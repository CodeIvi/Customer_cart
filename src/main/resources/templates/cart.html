<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Carrito de Compra</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container my-5">
    <div class="card shadow">
        <div class="card-body">

            <h2 class="card-title mb-4">Step 1 of 3 - Shopping Cart</h2>

            <h3 class="mb-3">Products in your cart</h3>

            <table class="table table-striped table-hover">
                <thead class="table-dark">
                <tr>
                    <th>Name</th>
                    <th>Unit price</th>
                    <th>Quantity</th>
                    <th>Subtotal</th>
                    <th colspan="3">Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${orderlist}">
                    <td th:text="${item.productName}">Product name</td>
                    <td th:text="${item.unitPrice} + ' €'">0.00 €</td>
                    <td th:text="${item.quantity}">1</td>
                    <td th:text="${item.lineTotal} + ' €'">0.00 €</td>
                    <td>
                        <form th:action="@{/cart/yourcart}" method="post">
                            <input type="hidden" name="idProduct" th:value="${item.id}">
                            <input type="hidden" name="action" value="subtract">
                            <input type="hidden" name="idCart" th:value="${idCart}">
                            <button type="submit" class="btn btn-sm btn-warning">[-]</button>
                        </form>
                    </td>
                    <td>
                        <form th:action="@{/cart/yourcart}" method="post">
                            <input type="hidden" name="idProduct" th:value="${item.id}">
                            <input type="hidden" name="idCart" th:value="${idCart}">
                            <input type="hidden" name="action" value="increment">
                            <button type="submit" class="btn btn-sm btn-success">[+]</button>
                        </form>
                    </td>
                    <td>
                        <form th:action="@{/cart/yourcart}" method="post">
                            <input type="hidden" name="idProduct" th:value="${item.id}">
                            <input type="hidden" name="action" value="delete">
                            <input type="hidden" name="idCart" th:value="${idCart}">
                            <button type="submit" class="btn btn-sm btn-danger">[X]</button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>

            <hr/>

            <h3 class="mb-3">Add new product</h3>
            <form th:action="@{/cart/yourcart}" method="post" class="row g-3">
                <div class="col-md-6">
                    <select name="idAddProduct" class="form-select">
                        <option value="">-- Seleccione --</option>
                        <option th:each="prod : ${listaProductos}"
                                th:value="${prod.id}"
                                th:text="${prod.name}">
                        </option>
                    </select>
                </div>
                <div class="col-md-3">
                    <input type="number" name="quantity" class="form-control" placeholder="Quantity">
                </div>
                <input type="hidden" name="action" value="add">
                <input type="hidden" name="idCart" th:value="${idCart}">
                <div class="col-md-3">
                    <button class="btn btn-primary w-100">Add</button>
                </div>
            </form>

            <hr/>

            <h3 class="mb-3">Select discount</h3>
            <form th:action="@{/cart/yourcart}" method="post" class="row g-3">
                <div class="col-md-6">
                    <select name="coupon" class="form-select">
                        <option value="">-- Seleccione --</option>
                        <option th:each="coupon : ${couponList}"
                                th:value="${coupon.getCode()}"
                                th:text="${coupon.code}">
                        </option>
                    </select>
                </div>
                <input type="hidden" name="idCart" th:value="${idCart}">
                <div class="col-md-3">
                    <button class="btn btn-info w-100">Apply</button>
                </div>
            </form>

            <div th:if="${appliedCoupon != null}" class="alert alert-success mt-3">
                Applied coupon: <span th:text="${appliedCoupon}"></span> →
                <span th:text="('-' + discount) + ' €'">-0.00 €</span>
            </div>

            <hr/>

            <div class="mt-4">
                <p>Gross total: <b th:text="${grossTotal} + ' €'">0.00 €</b></p>
                <p>Coupon discount: <b th:text="('-' + ${discount}) + ' €'">-0.00 €</b></p>
                <p>Total to pay: <b th:text="${totalToPay} + ' €'">0.00 €</b></p>
            </div>

            <div class="mt-4 text-end">
                <a class="btn btn-lg btn-success" th:href="@{/cart/checkout/step2}">
                    Continue to Step 2 >
                </a>
            </div>

        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>